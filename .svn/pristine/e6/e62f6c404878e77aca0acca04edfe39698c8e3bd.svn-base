<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-col-space15 {
            /* margin: -7.5px; */
            margin:-7.5px 0 !important;
        }
    </style>
</head>
<body>
<div style="padding: 12px;" class="search_wrap">
    <form class="layui-form" action="">
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">用户名</label>
            <div class="layui-input-inline">
                <input type="text" name="username" id="username" autocomplete="off" class="layui-input" value=''>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">真实姓名</label>
            <div class="layui-input-inline">
                <input type="text" name="username" id="realname" autocomplete="off" class="layui-input" value=''>
            </div>
        </div>
    </form>
</div>
<div class="layui-btn-group demoTable"  style="padding: 0 15px;">
  <button class="layui-btn layui-btn-sm" data-type="search">搜索</button>
  <button type="button" id="refresh" class="layui-btn  layui-btn-sm">
      <i class="layui-icon layui-icon-refresh"></i>
  </button>
  <button class="layui-btn layui-btn-sm" data-type="add">添加</button>
</div>
<div style="padding: 0 15px;">
    <table class="layui-table" id="demo" lay-filter="demo">
    </table>
</div>

<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
</script>
<script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
<script>
    layui.config({
        version: true,
        base: '/assets/model/'
    }).extend({
        common: 'common/js/common',
        search: 'common/js/search',
    }).use(['table','laydate','common','jquery'], function(){
    var table   = layui.table,
        $ = layui.laydate,
        common = layui.common,
        laydate = layui.laydate;


        //第一个实例
        table.render({
            elem: '#demo',
            headers:common.getHeader()
            ,height: 'full-150'
            ,url: common.getUrl('gsuser/user') //数据接口
            ,page: false //开启分页
            ,cols: [[ //表头
                {field:'id', minWidth:80,title:'ID',sort: true}
                ,{field:'username', minWidth:120,title:'用户名'}
                ,{field:'realname', minWidth:80,title:'真实姓名'}
                ,{field:'last_login_time', minWidth:120,title:'最近登录'}
                ,{field: 'last_ip', title: '最近登录IP', minWidth:120}
                ,{minWidth:180, align:'center', toolbar: '#barDemo'}


            ]]
            ,parseData:function(res){

                console.log(res);return  false;
                if(res.code != 0){

                    layer.msg(res.msg,{icon:2});
                    res.msg = '获取失败';
                }

                return {
                    'code' : res.code,
                    'msg' : res.msg,
                    'data' : res.data,
                    'count' : res.count,
                }
            }
            ,limit:20

        });


    //监听工具条
    table.on('tool(demo)', function(obj){
        var data = obj.data;
        if(obj.event === 'edit'){
            //编辑
            layer.open({
                type: 2,
                title: "修改用户",
                maxmin: true,
                shadeClose: true, //点击遮罩关闭层
                area : ['80%' , '60%'],
                content: "/admin/gsuser/update_user?id="+data.id
            });
        }
    });

    $('.demoTable .layui-btn').on('click', function(){
        var type = $(this).data('type');
        if( type=='add' ){
            //添加
            layer.open({
                type: 2,
                title: "添加用户",
                maxmin: true,
                shadeClose: true, //点击遮罩关闭层
                area : ['80%' , '60%'],
                content: "/admin/gsuser/add_user"
            });
        }else if( type=='search' ){
            //搜索
            var username   = $('#username').val(),
                realname   = $('#realname').val();
            table.reload('idTest', {
                method: 'post'
                , where: {
                    'username' : username,
                    'realname' : realname
                }
                , page: {
                    curr: 1
                }
            });
        }
    });
});
//给子级调用
function res_msg(msg){
    layer.msg(msg,{icon:1});
    setTimeout(function(){
        window.location.reload();
    },1000);
}
</script>
</body>
</html>