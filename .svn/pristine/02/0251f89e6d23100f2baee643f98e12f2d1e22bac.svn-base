<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/common.css"/>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-col-space15 {
            /* margin: -7.5px; */
            margin:-7.5px 0 !important;
        }
    </style>
</head>
<body>
<style>
    .layui-form-item .layui-form-checkbox { margin: 0; }
    #reload_time_wrap input.layui-input { height: 30px; }
</style>
<div style="padding: 12px;"  class="search_wrap">
    <form class="layui-form" action="" id="search_form">
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">类型: </label>
            <div class="layui-input-inline">
                <select name="type"  lay-filter="type" id="type" lay-search="">
                    <option value="">选择或搜索</option>
                    <option value="1">封禁</option>
                    <option value="2">解封</option>

                </select>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">处理人: </label>
            <div class="layui-input-inline">
                <input type="text" name="admin_user" id="admin_user" autocomplete="off" class="layui-input" >
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">账号: </label>
            <div class="layui-input-inline">
                <input type="text" name="user_name" id="user_name" autocomplete="off" class="layui-input" >
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">时间: </label>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" name="sdate" id="sdate" lay-verify="sdate" placeholder="YYYY-MM-dd HH:mm:ss" autocomplete="off" class="layui-input" lay-key="1" value="{{ date('Y-m-d 00:00:00') }}">
            </div>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" name="edate" id="edate" lay-verify="edate" placeholder="YYYY-MM-dd HH:mm:ss" autocomplete="off" class="layui-input" lay-key="2" value="{{ date('Y-m-d 23:59:59') }}">
            </div>
        </div>
    </form>
</div>
<div class="layui-btn-group demoTable" style="padding: 0 15px;">
    <button class="layui-btn layui-btn-sm" data-type="search" id="search_btn">搜索</button>
    <button type="button" id="refresh" class="layui-btn  layui-btn-sm">
        <i class="layui-icon layui-icon-refresh"></i>
    </button>
    <!--<button class="layui-btn layui-btn-sm layui-btn-danger" data-type="ban_user" id="ban_user">封禁/解封账号</button>-->
    <button class="layui-btn layui-btn-sm" data-type="multi_ban">批量封禁</button>
</div>
<div class="table_wrap" style="padding: 0 15px;">
    <table class="layui-table" lay-filter="table-list"  id="table-list">

    </table>
</div>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="block">封禁</a>
</script>
<script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
<script>

    var where = {};
    layui.config({
        version: true,
        base: '/assets/model/'
    }).extend({
        common: 'common/js/common',
    }).use(['common','jquery','form','common','laydate','table'], function () {
        var $ = layui.jquery,
            form = layui.form,
            common = layui.common,
            layer = layui.layer,
            laydate = layui.laydate,
            table = layui.table,
            element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

        var pdata = common.urlParam;
        //时间
        laydate.render({
            elem: '#sdate',
            type: 'datetime',
            value: new Date(Date.parse(new Date())-86400000)
        });
        laydate.render({
            elem: '#edate',
            type: 'datetime',
            value: new Date(Date.parse(new Date()))
        });


        // 表格请求初始化
        var cols = [[
            ,{'title':'平台id','field':'uid'}
            ,{'title':'处理类型','field':'type'}
            ,{'field':'user_name','title':'账号'}
            ,{'field':'dateline','title':'处理时间'}
            ,{'field':'admin_user','title':'处理人'}
            ,{'field':'ban_time','title':'封禁时长'}
            ,{'field':'reason','title':'说明'}

        ]];

        table.render({
            elem: '#table-list'
            ,height: 'full-120'
            ,headers:common.getHeader()
            ,url: common.apiUrl+'player/ban_user_list' //数据接口
            ,page: false //开启分页
            ,limits:[20,50,100,200,500]
            ,limit:20
            ,minWidth:1000
            ,cols: cols
            ,method:'POST'
            ,where:pdata
            ,done:function(a,b,c){

                console.log(a)
                console.log(b)
                console.log(c)
                lay_page = b;
                if(c > 0){

                }
                //隐藏加载框
                common.isLoading(false);

            }
        });




        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');

            if( type=='ban_user' ){
                //编辑
                 layer.open({
                     type: 2,
                     title: "封禁/解封账号",
                     maxmin: true,
                     shadeClose: true, //点击遮罩关闭层
                     area : ['80%' , '60%'],
                     content: "/admin/ban/ban_user"
                 });
            }else if( type=='ban_ip' ){
                //编辑
                 layer.open({
                     type: 2,
                     title: "封禁/解封IP",
                     maxmin: true,
                     shadeClose: true, //点击遮罩关闭层
                     area : ['80%' , '60%'],
                     content: "/admin/ban/ban_ip"
                 });
            }else if(type == 'multi_ban'){

                layer.open({
                    type: 2,
                    title: "批量操作",
                    maxmin: true,
                    shadeClose: true, //点击遮罩关闭层
                    area : ['70%' , '70%'],
                    content: "platform_ban.html"
                });
            }else if( type=='ban_imei' ){
                //编辑
                 layer.open({
                     type: 2,
                     title: "封禁/解封IMEI",
                     maxmin: true,
                     shadeClose: true, //点击遮罩关闭层
                     area : ['80%' , '60%'],
                     content: "/ban/ban_imei"
                 });
            }else if( type=='search' ){
                let form_data = $('#search_form').serializeArray();
                $.each(form_data,function(k,v){
                    where[v.name] = v.value;
                })

                table.reload('table-list', {
                    method: 'post'
                    ,where: where

                    ,page: {
                        curr: 1
                    },
                });
            }
        });
    });
    //给子级调用
    function res_msg(msg){
        layer.msg(msg,{icon:1});
        setTimeout(function(){
            window.location.reload();
        },1000);
    }
</script>
</body>
</html>