<?php

use extend\GamekeySign\GamekeySignBase;

class dxcq2 extends GamekeySignBase
{

    public $from = 'zhangWan';

    public $return_form = 2; //判断是否需要返回转接口的所有数据

    private $secret = 'skHVv95EI7DG1sAzdNZZxlFDyG3IKCre';

    public $uid_to_sdkid_url = "http://us.hnzwwl.cn/api/get_sdkuid.php";

    public $sdkid_to_uid_url = "http://us.hnzwwl.cn/api/get_sdkuid.php";


	public function __construct(){

    }

    #根据cp给的聚合uid换成平台自身的uid，用于信息推送时候替换成自己平台的uid,type1代表掌玩聚合id换平台id，2代表平台id换掌玩聚合id
    public function uid_to_sdkid_url($sdkid){

	    if(empty($sdkid)){
	        return false;
        }

        $time = time();
        $key = 'c1b5d4dc0084b4db0af583f8d399d980';
        $sign = md5($sdkid.$time.$key);
        $post_data = [
            'uid'  => $sdkid,
            'time' => $time,
            'sign' => $sign,
            'type' => 2
        ];

	    $res = $this->fetchUrl($this->sdkid_to_uid_url.'?'.http_build_query($post_data));
        $res = json_decode($res,1);

        if(isset($res['code']) && $res['code'] == 1){
            $uid = $res['data']['success'][0]['uid'];
            return $uid;

        }else{
            return false;
        }

    }


    public function beforeChangeData($chat_info)
    {
        //特殊处理大侠传奇2
        if( $chat_info['gkey'] == 'dxcq2'){

            $chat_info['tkey'] = 'zw';
        }

        return $chat_info;
    }

}