<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/common.css"/>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-col-space15 {
            /* margin: -7.5px; */
            margin:-7.5px 0 !important;
        }
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
    <form class="layui-form" action="" style="padding: 20px;" id="search_form" lay-filter="edit-form">
        <div class="layui-form-item">
            <label class="layui-form-label">关联客服产品</label>
            <div class="layui-input-inline">
                <select name="product_code" lay-filter="product_code" lay-verify="gt0" id="product_code">

                </select>
            </div>
        </div>

        <input type="hidden" id='id' name="id" value="">
        <div class="layui-form-item">
            <div class="layui-input-block">
              <button type="submit" class="layui-btn" lay-submit="" lay-filter="submit_btn">立即提交</button>
            </div>
        </div>
    </form>


</body>
</html>
<script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
<script>

    layui.config({
        version: true,
        base: '/assets/model/'
    }).extend({
        common: 'common/js/common',
    }).use(['form','common','jquery'], function(){
        var form = layui.form,
            common = layui.common,
            $ = layui.jquery;

        var pdata = common.urlParam;

        $('#id').val(pdata.id);

        common.req({
            url: "ajax/getCustomerProduct",
            type: "post",
            dataType:"json",
            success:function(data){

                var optionstring = "";
                $.each(data.data, function(i,item){
                    console.log(item)
                    optionstring += "<option value=\"" + item.code + "\" >" + item.name + "</option>";
                });
                $("#product_code").html(optionstring);
                form.render('select'); //这个很重要
            },
        })


        // function getInfo(){
        //     common.req({
        //         url: "garrison_product/getInfo?id="+pdata.id,
        //
        //         type: "get",
        //         dataType:"json",
        //         success:function(res){
        //             console.log(res);
        //             if( res.code==0 ){
        //                 let form_data = $('#search_form').serializeArray();
        //                 // json.data.keywords = json.data.keyword;
        //                 // console.log(json.data)
        //                 form.val('edit-form',res.data)
        //
        //                 $("#product_id").html('<option value='+res.data.product_id+'>'+res.data.product_name+'</option>');
        //                 form.render()
        //
        //
        //             }
        //         },
        //         error:function(res){
        //             layer.alert('错误'+res.msg,{icon:2});
        //         }
        //     });
        // }


        //监听提交
        form.on('submit(submit_btn)', function(data){

            common.req({
                url: "platform_product/edit",
                data: data.field,
                type: "post",
                dataType:"json",
                success:function(res){
                    console.log(res);
                    if( res.code==0 ){
                        var index = parent.layer.getFrameIndex(window.name);
                        window.parent.res_msg(res.msg);
                        parent.layer.close(index);//关闭当前页
                        //window.parent.location.reload(); //刷新父窗口
                    }
                },
                error:function(res){
                    layer.alert('错误'+res.msg,{icon:2});
                }
            });
            return false;
        });



    });
</script>