<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/common.css"/>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-col-space15 {
            /* margin: -7.5px; */
            margin:-7.5px 0 !important;
        }
    </style>
</head>
<body>
<div style="padding: 12px;"  class="search_wrap">
    <form class="layui-form" action="" id="search_form">



        <div class="layui-inline" style="margin-bottom: 6px;">

        </div>

        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">开服时间: </label>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" name="start_time" id="start_time" lay-verify="start_time" placeholder="YYYY-MM-dd HH:mm:ss" autocomplete="off" class="layui-input" lay-key="1" value="">
            </div>
            <div class="layui-input-inline" style="width: 200px;">
                <input type="text" name="end_time" id="end_time" lay-verify="end_time" placeholder="YYYY-MM-dd HH:mm:ss" autocomplete="off" class="layui-input" lay-key="2" value="">
            </div>
        </div>

        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">区服范围: </label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="start_sid" id="start_sid" autocomplete="off" class="layui-input" >
            </div>-
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="end_sid" id="end_sid" autocomplete="off" class="layui-input" >
            </div>

        </div>

        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">数据类型: </label>
            <div class="layui-input-inline">
                <select name="type"  lay-filter="type" id="type" lay-search="">
                    <option value="1">LTV数据</option>
                    <option value="2">留存数据</option>

                </select>
            </div>
        </div>

    </form>
</div>
<div class="layui-btn-group demoTable" style="padding: 0 15px;">
    <button class="layui-btn layui-btn-sm" data-type="search">搜索</button>
    <button type="button" id="refresh" class="layui-btn  layui-btn-sm">
        <i class="layui-icon layui-icon-refresh"></i>
    </button>
</div>
<div class="table_wrap" style="padding: 0 15px;">
    <table class="layui-table"   lay-filter="demo" id="demo" >

    </table>
</div>

<script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
<script>
    var where = {};
    layui.config({
        version: true,
        base: '/assets/model/'
    }).extend({
        common: 'common/js/common',
        search: 'common/js/search',
    }).use(['common','jquery','form','search','element','laydate','table'], function () {
        var $ = layui.jquery;
        var form = layui.form;
        var laydate = layui.laydate;
        var table = layui.table;
        var common = layui.common;
        var search = layui.search;
        element = layui.element;


        SearchData();
        function SearchData() {

            var params = {};
            params.start_time = $("#start_time").val();
            params.end_time = $("#end_time").val();
            params.start_sid = $("#start_sid").val();
            params.end_sid = $("#end_sid").val();
            params.type = $("#type").val();

            var mycars = new Array();

            var result;
            common.req({
                url: 'game_ltv/index', // //请求路径
                type: "post",// "post", //请求方式
                dataType: 'json', //期望获得的返回值类型
                async: false, //是否异步
                data: params, //传递的参数
                success: function (data) {

                    if (data != '') {

                        result = data.data;

                        var strs = new Array();
                        strs = result;
                        mycars = [
                            { field: 'sid', title: '区服', align: 'center', minWidth: 120, sort: false},
                            { field: 'open_time', title: '开服时间', align: 'center', minWidth: 120, sort: false},
                            ];

                        for(let i=0;i<30;i++){

                            mycars.push({
                                field: 'day-'+i, title: i+'天数据', align: 'center', minWidth: 120, sort: false
                            })
                        }



                        // for (var k in strs) {
                        //
                        //     for(k1 in strs[k]['data']){
                        //         mycars.push({
                        //             field: k1, title: k1+'天数据', align: 'center', minWidth: 120, sort: false
                        //         })
                        //     }
                        //     // mycars.push({
                        //     //     field: k, title: k+'天数据', align: 'center', minWidth: 120, sort: false
                        //     // });
                        // }

                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {

                    //console.log('状态码：' + jqXHR.status);
                    //console.log('错误信息：' + jqXHR.statusText);
                    //console.log('服务器反馈信息：' + textStatus);
                }
            });

            //第一个实例
            table.render({
                elem: '#demo',
                headers:common.getHeader()
                ,height: 'full-150'
                ,url: common.getUrl('game_ltv/index') //数据接口
                ,page: false //开启分页
                ,cols: [mycars]


            });
        };






        //时间
        laydate.render({
            elem: '#start_time',
            type: 'datetime'
        });
        laydate.render({
            elem: '#end_time',
            type: 'datetime'
        });

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
             if( type=='search' ){
                //搜索
                let form_data = $('#search_form').serializeArray();
                $.each(form_data,function(k,v){
                    where[v.name] = v.value;
                })
                table.reload('demo', {
                    method: 'post'
                    ,where: where
                    ,page: {
                        curr: 1
                    }
                });
            }
        });

    });
    //给子级调用
    function res_msg(msg){
        layer.msg(msg,{icon:1});
        setTimeout(function(){
            window.location.reload();
        },1000);
    }
</script>
</body>
</html>