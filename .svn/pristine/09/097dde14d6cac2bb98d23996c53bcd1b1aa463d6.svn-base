<?php
/**
 * vip
 */
namespace app\admin\controller;

use common\server\Vip\RecallServer;

class Recall extends Oauth
{
    protected $no_oauth = [
        'codeListConfig',
    ];

    #礼包码-列表
    public function codeList()
    {
        $data = $this->getPost([
            ['platform_id', 'int', 0],
            ['admin_id', 'int', 0],
            ['status', 'int', -1],
            ['p_up', 'trim', ''],
            ['up_id', 'int', 0],
            ['code', 'trim', ''],
        ]);

        $this->rs = array_merge($this->rs,RecallServer::codeList($data));

        return return_json($this->rs);
    }
    #礼包码-列表配置
    public function codeListConfig(){

        $this->rs['data'] = RecallServer::codeConfig();

        return return_json($this->rs);
    }
    #礼包码-详情
    public function codeDetail(){
        $id = $this->req->post('id/d',0);

        $this->rs = array_merge($this->rs,RecallServer::codeDetail($id));

        return return_json($this->rs);
    }
    #礼包码-添加
    public function codeAdd(){
        $p_data = $this->getPost([
            ['up_id', 'int', 0],
            ['code', 'trim', ''],
            ['status', 'int', 0],
            ['platform_id', 'int', 0],
        ]);
        $res = RecallServer::codeSave($p_data);
        if($res){
            $this->rs['msg'] = '操作成功';
        }else{
            $this->rs['code'] = 1;
            $this->rs['msg'] = '操作失败';
        }

        return return_json($this->rs);
    }
    #礼包码-修改
    public function codeEdit(){
        $p_data = $this->getPost([
            ['id', 'int', 0],
            ['up_id', 'int', 0],
            ['code', 'trim', ''],
            ['status', 'int', 0],
            ['platform_id', 'int', 0],
        ]);
        $res = RecallServer::codeSave($p_data);
        if($res){
            $this->rs['msg'] = '操作成功';
        }else{
            $this->rs['code'] = 1;
            $this->rs['msg'] = '操作失败';
        }

        return return_json($this->rs);
    }

    #礼包码-分组-列表
    public function codeGroupList()
    {
        $data = $this->getPost([
            ['platform_id', 'int', 0],
            ['admin_id', 'int', 0],
            ['status', 'int', -1],
            ['p_up', 'trim', ''],
            ['name', 'trim', ''],
        ]);

        $this->rs = array_merge($this->rs,RecallServer::codeGroupList($data));

        return return_json($this->rs);
    }
    #礼包码-分组-列表配置
    public function codeGroupListConfig(){

        $this->rs['data'] = RecallServer::codeGroupConfig();

        return return_json($this->rs);
    }
    #礼包码-分组-详情
    public function codeGroupDetail(){
        $id = $this->req->post('id/d',0);

        $this->rs = array_merge($this->rs,RecallServer::codeGroupDetail($id));

        return return_json($this->rs);
    }
    #礼包码-分组-添加
    public function codeGroupAdd(){
        $p_data = $this->getPost([
            ['up_id', 'int', 0],
            ['status', 'int', 0],
            ['type', 'int', 0],
            ['platform_id', 'int', 0],
            ['title', 'trim', ''],
            ['code', 'trim', ''],
        ]);

        $res = RecallServer::codeGroupSave($p_data);
        if($res){
            $this->rs['msg'] = '操作成功';
        }else{
            $this->rs['code'] = 1;
            $this->rs['msg'] = '操作失败';
        }

        return return_json($this->rs);
    }
    #礼包码-分组-修改
    public function codeGroupEdit(){
        $p_data = $this->getPost([
            ['id','int',0],
            ['up_id', 'int', 0],
            ['status', 'int', 0],
            ['type', 'int', 0],
            ['platform_id', 'int', 0],
            ['title', 'trim', ''],
            ['code', 'trim', ''],
        ]);
        $res = RecallServer::codeGroupSave($p_data);
        if($res){
            $this->rs['msg'] = '操作成功';
        }else{
            $this->rs['code'] = 1;
            $this->rs['msg'] = '操作失败';
        }

        return return_json($this->rs);
    }
}
