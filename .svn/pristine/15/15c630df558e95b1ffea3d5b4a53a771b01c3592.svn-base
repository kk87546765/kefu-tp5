
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!-- 页面加载loading -->
<div class="page-loading">
    <div class="ball-loader">
        <span></span><span></span><span></span><span></span>
    </div>
</div>

<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body table-tool-mini">
            <div class="layui-form toolbar">
                <div class="layui-form-item">
					<blockquote class="layui-elem-quote">
                    <div class="layui-inline">
                        <label class="layui-form-label w-auto">用户名：</label>
                        <div class="layui-input-inline">
							<select name="user_id" id="user_id" lay-filter="user_id">
								<option value="">全部</option>
							</select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label w-auto">登陆时间：</label>
                        <div class="layui-input-inline">
                            <input type="text" class="layui-input" autocomplete="off" name="time" id="time" placeholder=" - ">
                        </div>
                    </div>
					
					
                    <div class="layui-inline" style="padding-right: 110px;">
                        <button class="layui-btn icon-btn" lay-filter="search" lay-submit>
                            <i class="layui-icon">&#xe615;</i>搜索
                        </button>
                    </div>
					</blockquote>
                </div>
            </div>
			<table class="layui-hide" id="table" lay-filter="table"></table>
        </div>
    </div>
</div>
<script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
<script>
	layui.config({
	    version: true,
	    base: '/assets/model/'
	}).extend({
	    common: 'common/js/common',
	}).use(['layer', 'form','jquery','common','table','laydate','util'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var laydate = layui.laydate;
        var util = layui.util;
        var form = layui.form;
        var table = layui.table;
        var common = layui.common;
		var time = layui.data('time');
		var stime = util.toDateString((time.now_time - 604800)*1000,'yyyy-MM-dd');
		var etime = util.toDateString(time.now_time*1000,'yyyy-MM-dd');
		laydate.render({
			elem: '#time'
			,range: true
			,min:util.toDateString((time.now_time - 5184000)*1000,'yyyy-MM-dd')
			,value:stime+' - '+etime
		});
		//获取用户列表
		if(common.hasPower('node_user/get_all_user'))
		{
			common.req({
				url:'node_user/get_all_user'
				,async:false
				,success:function(json)
				{
					if(json.code == 1)
					{
						var str = '';
						if(json.data.list)
						{
							$.each(json.data.list,function(i,t)
							{
								str += '<option value="'+i+'">'+t+'</option>';
							});
						}
						if(str)
						{
							$('#user_id').append(str);
							form.render();
						}
						else
						{
							$('#user_id').parents('.layui-inline').hide();
						}
					}
					else if(json.code != 3)
					{
						layer.msg(json.msg, {icon: 2});
					}
				}
			});
		}
		else
		{
			$('#user_id').parents('.layui-inline').hide();
		}
		
		//查询
		get_search();
		function get_search(flag,data)
		{
			if(flag)
			{
				layer.load(2);
			}
			var stime,user_id,etime = '';
			if(data)
			{
				var arr = data.time.split(' - ');
				stime = arr[0];
				etime = arr[1];
				user_id = data.user_id;
			}
			common.req({
				url:'user/login_msg'
				,data:{user_id:user_id,stime:stime,etime:etime}
				,success:function(json)
				{
					if(flag)
					{
						layer.closeAll('loading');
					}
					else
					{
						common.isLoading(false);
					}
					if(json.code == 1)
					{
						table.render({
							elem: '#table'
							,toolbar: true
							,data: json.data.list
							,limit:common.limit
							,limits:common.get_limit(json.data.count)
							,title: '用户数据表'
							,totalRow: true
							,cols: json.data.cols
							,page: true
							,done: function () {
								layer.closeAll('loading');
							}
						});
					}
					else if(json.code != 3)
					{
						layer.msg(json.msg, {icon: 2});
					}
				}
			});
		}
		form.on('submit(search)',function(data)
		{
			get_search(true,data.field);
			return false;
		});
    });
</script>
</body>
</html>