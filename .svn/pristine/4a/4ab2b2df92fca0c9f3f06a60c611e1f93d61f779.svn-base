<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/common.css"/>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-col-space15 {
            /* margin: -7.5px; */
            margin:-7.5px 0 !important;
        }
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<form class="layui-form" lay-filter="edit-form" action="" style="padding: 20px;" id="search_form">
    <div class="layui-form-item">
        <label class="layui-form-label">游戏</label>
        <div class="layui-input-inline">
            <select name="game"  lay-filter="game" id="game" lay-search="">
                <option value="">选择或搜索</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">关键词</label>
        <div class="layui-input-inline">
            <textarea id='keyword' name="keywords"  rows="10" cols="40" ></textarea>
            <div style="margin-top: 5px; color: red;">一个或多个,  多个请换行</div>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">封禁类型</label>
        <div class="layui-input-inline">
            <select name="type"  lay-filter="type" id="type" lay-search="">
                <option value="" >选择或搜索</option>
                <option value="1" >封号+禁言</option>
                <option value="2" >禁言</option>
                <option value="3" >封号</option>
            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">封禁时长（小时）</label>
        <div class="layui-input-inline">
            <input type="text" name="block_time" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">禁言时长（小时）</label>
        <div class="layui-input-inline">
            <input type="text" name="ban_time" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">谐音/形匹配</label>
        <div class="layui-input-inline">
            <input type="checkbox" name="resemble_status" id='resemble_status' lay-skin="switch"  lay-text="开启|关闭" lay-filter="resemble_status_btn" >
        </div>
    </div>
    <div class="layui-form-item">
            <label class="layui-form-label">触发限制</label>
            <div class="layui-input-inline">
               <input type="checkbox" name="status" id='status' lay-skin="switch"  lay-text="开启|关闭"  lay-filter="status_btn">
            </div>
        </div>
        <div class="layui-form-item">
                <label class="layui-form-label">等级</label>
                <div class="layui-input-inline" style="width: 100px;">
                      <input type="text" name="level_min" id="level_min" placeholder="最低"   disabled  value=""  autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid">-</div>
                    <div class="layui-input-inline" style="width: 100px;">
                      <input type="text" name="level_max" id="level_max" placeholder="最高"  disabled value=""  autocomplete="off" class="layui-input">
                    </div>
            </div>
        <div class="layui-form-item">
            <label class="layui-form-label">充值</label>
            <div class="layui-input-inline" style="width: 100px;">
                  <input type="text" name="money_min" id="money_min" placeholder="￥"  disabled  value=""  autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 100px;">
                  <input type="text" name="money_max" id="money_max"  placeholder="￥"  disabled  value=""  autocomplete="off" class="layui-input">
                </div>
        </div>
        <div class="layui-form-item">
                <label class="layui-form-label">可触发次数</label>
                <div class="layui-input-inline">
                   <input type="text" name="num" id="num" required lay-verify="required" disabled  value=''  placeholder="请输入次数" autocomplete="off" class="layui-input">
                </div>
            </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="submit_btn">立即提交</button>
        </div>
    </div>

</form>
<script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
<script>
    layui.config({
        version: true,
        base: '/assets/model/'
    }).extend({
        common: 'common/js/common',
    }).use(['form', 'table','layedit', 'laydate','common','jquery'], function(){
        var table   = layui.table
            ,form = layui.form
            ,layer = layui.layer
            ,layedit = layui.layedit
            ,common = layui.common
            ,$ = layui.jquery
            ,laydate = layui.laydate;

        var pdata = common.urlParam;
        form.on('switch(status_btn)', function(data){
            if(data.elem.checked){
                $('input[name="level_min"]').removeAttr("disabled");
                $('input[name="level_max"]').removeAttr("disabled");
                $('input[name="money_min"]').removeAttr("disabled");
                $('input[name="money_max"]').removeAttr("disabled");
                $('input[name="num"]').removeAttr("disabled");
            }else{
                $('input[name="level_min"]').attr("disabled","disabled");
                $('input[name="level_max"]').attr("disabled","disabled");
                $('input[name="money_min"]').attr("disabled","disabled");
                $('input[name="money_max"]').attr("disabled","disabled");
                $('input[name="num"]').attr("disabled","disabled");
            }
        });

        common.req({
            url:'keyword/getProductList'
            ,success:function(json)
            {
                if(json.code == 0){
                    let html = '';
                    $.each(json.data,function(k,v){

                        html ='<option value="'+v.code+'">'+v.name+'</option>';
                        $('#game').append(html)
                    })

                    form.render('select');


                }else {
                    layer.msg(json.msg,{icon:2});
                }
            }
        })

        common.req({
            url:'keyword/getEditInfo'
            ,data:{'id':pdata.id}
            ,success:function(json)
            {
                if(json.code == 0) {
                    let form_data = $('#search_form').serializeArray();
                    json.data.keywords = json.data.keyword;
                    console.log(json.data)
                    form.val('edit-form',json.data)

                    form.render()

                }
            }
        })

        //监听提交
        form.on('submit(submit_btn)', function(data){
            if(data.field.status == 'on'){
                data.field.status = 1;
            }
            if(data.field.resemble_status == 'on'){
                data.field.resemble_status = 1;
            }
            data.field.id = pdata.id;
            common.req({
                url: "keyword/edit",
                data: data.field,
                type: "post",
                dataType:"json",
                success:function(data){
                    if( data.code == 0 ){
                        var index = parent.layer.getFrameIndex(window.name);
                        layer.open({
                            title: '提示'
                            ,content: data.msg
                            ,btn: ['确定']
                            ,yes: function(index, layero){
                                parent.layer.close(index);
                                window.parent.location.reload()
                        }
                        });
                        // window.parent.res_msg(data.msg);
                        // parent.layer.close(index);//关闭当前页
                        //window.parent.location.reload(); //刷新父窗口
                    }else{
                        layer.msg(data.msg,{icon:2});
                    }
                },
                error:function(data){
                    layer.alert('错误'+data.msg,{icon:2});
                }
            });
            return false;
        });
    });
</script>
</body>
</html>