<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>游娱客服后台</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/phone.css"/>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
</head>
<style>
	.layui-nav-img{color:#333;display: block;float: left;margin-top: 8px;background-color: #A6DBFF;text-align: center;font-size: 23px;}
	.layui-nav-img span{position: relative;font-size: 25px;}
</style>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin" id="tabAdmin">
    <!-- 头部 -->
    <div class="layui-header">
        <div class="layui-logo">
            <img src="/assets/images/logo.png"/>
            <cite>&nbsp;后台管理系统</cite>
        </div>
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item" lay-unselect>
                <a ew-event="flexible" title="侧边伸缩"><i class="layui-icon layui-icon-shrink-right"></i></a>
            </li>
            <li class="layui-nav-item layui-hide-xs" lay-unselect="">
                <a href="http://baidu.com" target="_blank" title="前台">
                    <i class="layui-icon layui-icon-website"></i>
                </a>
            </li>
            <li class="layui-nav-item" lay-unselect>
                <a ew-event="refresh" title="刷新"><i class="layui-icon layui-icon-refresh-3"></i></a>
            </li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item layui-hide-xs" lay-unselect>
                <a ew-event="fullScreen" title="全屏"><i class="layui-icon layui-icon-screen-full"></i></a>
            </li>
            <li class="layui-nav-item" id="platform_model" lay-unselect>
                <a>
                    <cite id="platform_name">mh</cite>
                </a>
                <dl class="layui-nav-child" id="platform_child">
                    <!-- <dd lay-unselect>
                        <a ew-event="changePlatform" val='mh'>mh</a>
                    </dd>
                    <dd lay-unselect>
                        <a ew-event="changePlatform" val='ll'>ll</a>
                    </dd> -->
                    
                </dl>
            </li>
            <li class="layui-nav-item" id="users" lay-unselect>
                <a>
                    <div class="layui-nav-img">
						<span id="username"></span>
					</div>
                    <cite id="nickname"></cite>
                </a>
                <dl class="layui-nav-child">
                    <dd lay-unselect>
                        <a ew-event="psw">修改密码</a>
                    </dd>
                    <dd lay-unselect>
                        <a ew-event="update">更新缓存</a>
                    </dd>
        <!--             <dd lay-unselect>
                        <a ew-event="header_url">更换头像</a>
                    </dd> -->
                    <hr>
                    <dd lay-unselect>
                        <a ew-event="logout">退出</a>
                    </dd>
                </dl>
            </li>
            <li class="layui-nav-item" lay-unselect>
                <a ew-event="theme" title="主题"><i class="layui-icon layui-icon-more-vertical"></i></a>
            </li>
        </ul>
    </div>

    <!-- 侧边栏 -->
    <div class="layui-side">
        <div class="layui-side-scroll">
            <ul class="layui-nav layui-nav-tree" id="menu_tree" lay-filter="admin-side-nav" style="margin-top: 15px;">
                <li class="layui-nav-item">
                    <a><i class="layui-icon layui-icon-home"></i>&emsp;<cite>首页</cite></a>
                    <dl class="layui-nav-child">
                        <dd><a lay-href="/view/index/index.html">首页</a></dd>
                        <dd id="briefing_index"><a lay-href="/view/index/briefing_index.html">今日简报</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>

    <!-- 主体部分 -->
    <div class="layui-body" style="background-color: #ffffff; "></div>
</div>
<!-- 加载动画 -->
<div class="page-loading">
    <div class="ball-loader">
        <span></span><span></span><span></span><span></span>
    </div>
</div>
<!-- js部分 -->
<script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
<script>

    var sUserAgent = navigator.userAgent;
    var is_phone = false;
    if(sUserAgent.indexOf('Android') > -1 || sUserAgent.indexOf('iPhone') > -1 || sUserAgent.indexOf('iPad') > -1 || sUserAgent.indexOf('iPod') > -1 || sUserAgent.indexOf('Symbian') > -1 || window.innerWidth < 800)
    {
        is_phone = true;
    }
	layui.config({
	    version: true,
	    base: '/assets/model/'
	}).extend({
	    common: 'common/js/common',
	    Cropper: 'Cropper/Cropper',
	}).use(['common','jquery','element'], function () {
        var $ = layui.jquery;
	    var common = layui.common;
	    var element = layui.element;

        if(is_phone)
        {
            $('#users').hide();
            $('#tabAdmin').attr('class', 'layui-layout layui-layout-admin admin-nav-mini');//手机端默认隐藏菜单
        }

		//获取权限模块
		common.req({
			url:'user/model'
			,async:false
			,success:function(json)
			{
				if(json.code == 0 && json.data.menu)
				{
					//菜单
                    var str = '';
					$.each(json.data.menu,function(i,t)
					{
						if(t.children.length != 0)
						{
							str += '<li class="layui-nav-item">';
							str += '<a><i class="layui-icon '+t.url+'"></i>&emsp;<cite>'+t.menu_name+'</cite></a>';
							str += '<dl class="layui-nav-child">';
							$.each(t.children,function(i1,t1)
							{
								if(t1.url.length != 0 || t1.url.indexOf("/") != -1)
								{
									str += '<dd>';
									if(t1.url.length != 0)
									{
										if(t1.url.indexOf("/") != -1)
										{
											str += '<a 111 lay-href="/view/'+checkJumpUrl(t1.url)+'">'+t1.menu_name+'</a>';
										}
										else
										{
											str += '<a><i class="layui-icon '+t1.url+'"></i>&nbsp;<cite>'+t1.menu_name+'</cite></a>';
											str += '<dl class="layui-nav-child">';
											$.each(t1.children,function(i2,t2)
											{
												str += '<dd><a lay-href="/view/'+checkJumpUrl(t2.url)+'">'+t2.menu_name+'</a></dd>';
											});
											str += '</dl>';
										}
									}
									str += '</dd>';
								}
							});
							str += '</dl>';
							str += '</li>';
						}
					});
					$('#menu_tree').append(str);

                    //平台列表
                    if(json.data.platform.length > 1){
                        $.each(json.data.platform,function(k,v){
                            $('#platform_child').append('<dd lay-unselect><a ew-event="changePlatform" data-key="'+v.suffix+'" data-val="'+v.name+'" >'+v.name+'</a></dd>');
                            if(v.selected == 1){
                                $('#platform_name').html(v.name);
                            }
                        })
                    }else{
                        $('#platform_model').hide();
                    }

					element.init();
					//缓存权限
					layui.data('roleData',{
						'key':'data'
						,'value':JSON.stringify(json.data.role)
					});

                    if (!common.hasPower('home_index/briefing')) {
                        $('#briefing_index').remove();
                    }
				}else{
                    location.href = common.baseUrl + 'login.html';
                }
			}
		});
	    //初始化
	    common.loadView({
	        'view':'/view/index/index.html',
	        'title':'<i class="layui-icon layui-icon-home"></i>',
	    });
		common.req({
			url:'user/index'
			,success:function(json)
			{
				if(json.code == 0)
				{
					$('#nickname').html(json.data.nickname);
					if(json.data.header_url)
					{
						$('#username').html('<img src="'+json.data.header_url+'" id="header_url" style="margin-top:0" class="layui-nav-img">').parent().css({'marginTop':'8px'});
					}
					else
					{
						$('#username').html(json.data.username).css({'top':'-12px'});
					}
					layui.data('userData',{
						'key':'data'
						,'value':JSON.stringify(json.data)
					});
					common.isLoading(false);
				}else{
                    location.href = common.baseUrl + 'login.html';
                }
			}
		});

        function checkJumpUrl(str){
            if(str.indexOf(".html")==-1){
                str+='.html';   
            }

            return str;
        }
	});
</script>

<script>
    function topTabsPageCreate(obj){
        layui.config({
            version: true,
            base: '/assets/model/'
        }).use(['jquery','element'], function () {
            var $ = layui.jquery;
            var element = layui.element;

            let u = false;
            $(".layui-body>.layui-tab>.layui-tab-title>li").each(function() {
                if ($(this).attr("lay-id") === obj.url) {
                    u = true;
                    return false
                }
            });

            if(!u){
                let maxTabNum = 20;
                let mTabListLength = $(".layui-body>.layui-tab>.layui-tab-title>li").length;
                if ((mTabListLength + 1) >= maxTabNum) {
                    layer.msg("最多打开" + maxTabNum + "个选项卡", {
                        icon: 2
                    });
                    return;
                }
                element.tabAdd('admin-pagetabs', {
                    id: obj.url,
                    title: '<span class="title">'+ obj.title+ '</span>',
                    content: '<iframe lay-id="' + obj.url + '" src="' + obj.url + '" frameborder="0" class="admin-iframe"></iframe>'
                });
            }

            element.tabChange('admin-pagetabs', obj.url);
        });
    }
</script>

</body>
</html>