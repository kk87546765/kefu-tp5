<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/common.css"/>
    <script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
</head>
<style>
    .layui-form-pane .layui-form-label{
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .laytable-cell-checkbox .layui-disabled.layui-form-checked i {
        background: #fff !important;
    }
</style>
<div id="distribution-form" class="layui-form" lay-filter="distribution-form" style="padding: 20px;display: none;">

    <div class="layui-form-item">
        <label class="layui-form-label">vip专员1</label>
        <div class="layui-input-inline">
            <select name="admin_id" lay-filter="admin_id"  lay-search="">
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="submit_btn_distribution">立即提交</button>
        </div>
    </div>
</div>
<body>
<div style="padding: 12px;" class="search_wrap">
    <form class="layui-form" action="" id="search_form">
        
        <span id="common_search"></span>

        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">分配状态</label>
            <div class="layui-input-inline">
                <select name="distribute_static"  lay-filter="distribute_static" id="distribute_static" lay-search="">
                    <option value=0>全部</option>
                    <option value=1 >未分配</option>
                    <option value=2 >已分配</option>
                </select>
            </div>
        </div>

        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">账号</label>
            <div class="layui-input-inline">
                <input type="text" name="user_name" id="user_name" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">用户id</label>
            <div class="layui-input-inline">
                <input type="text" name="uid" id="uid" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">角色id</label>
            <div class="layui-input-inline">
                <input type="text" name="role_id" id="role_id" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">区服前缀</label>
            <div class="layui-input-inline">
                <input type="text" name="server_prefix" id="server_prefix" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">区服ID</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="server_id_min" id="server_id_min" autocomplete="off" class="layui-input" value=>
            </div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="server_id_max" id="server_id_max" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">区服后缀</label>
            <div class="layui-input-inline">
                <input type="text" name="server_suffix" id="server_suffix" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">充值状态</label>
            <div class="layui-input-inline">
                <select name="recharge_static"  lay-filter="recharge_static" id="recharge_static" lay-search="">
                    <option value=0>全部</option>
                    <option value=1 >充值活跃</option>
                    <option value=2 >充值沉默</option>
                    <option value=3 >充值流失</option>
                </select>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">登录状态</label>
            <div class="layui-input-inline">
                <select name="login_static"  lay-filter="login_static" id="login_static" lay-search="">
                    <option value=0>全部</option>
                    <option value=1 >登录活跃</option>
                    <option value=2 >登录沉默</option>
                    <option value=3 >登录流失</option>
                </select>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">总充值金额</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="total_pay_min" id="total_pay_min" autocomplete="off" class="layui-input" value=>
            </div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="total_pay_max" id="total_pay_max" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">近30天累充</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="thirty_day_pay_min" id="thirty_day_pay_min" autocomplete="off" class="layui-input" value=>
            </div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="thirty_day_pay_max" id="thirty_day_pay_max" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">单日最高累充金额</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="day_hign_pay_min" id="day_hign_pay_min" autocomplete="off" class="layui-input" value=>
            </div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="day_hign_pay_max" id="day_hign_pay_max" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">今天累充金额</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="today_pay_min" id="today_pay_min" autocomplete="off" class="layui-input" value=>
            </div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="today_pay_max" id="today_pay_max" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">单次充值金额</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="single_hign_pay_min" id="single_hign_pay_min" autocomplete="off" class="layui-input" value=>
            </div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="single_hign_pay_max" id="single_hign_pay_max" autocomplete="off" class="layui-input" value=>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">展示绑定手机</label>
            <div class="layui-input-inline">
                <select name="is_display_mobile"  lay-filter="is_display_mobile" id="is_display_mobile" lay-search="">
                    <option value=1 >是</option>
                    <option value=2 >否</option>
                </select>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">vip等级</label>
            <div class="layui-input-inline">
                <select name="vip_grade"  lay-filter="vip_grade" id="vip_grade" lay-search="">
                    <option value=0>全部</option>
                    <option value=1 >普通VIP</option>
                    <option value=2 >黄金VIP</option>
                    <option value=3 >铂金VIP</option>
                    <option value=4 >钻石VIP</option>
                    <option value=5 >至尊VIP</option>
                </select>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label w-auto">首次分配时间</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" id="first_distribute_time" name="first_distribute_time" value="" placeholder=" - " autocomplete="off">
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label w-auto">最后分配时间</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" id="last_distribute_time" name="last_distribute_time" value="" placeholder=" - " autocomplete="off">
            </div>
        </div>
        
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label w-auto">最后登录时间</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" id="last_login_time" name="last_login_time" value="" placeholder=" - " autocomplete="off">
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label w-auto">最后充值时间</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" id="last_pay_time" name="last_pay_time" value="" placeholder=" - " autocomplete="off">
            </div>
        </div>

        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label w-auto">最后录单时间</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" id="last_record_time" name="last_record_time" value="" placeholder=" - " autocomplete="off">
            </div>
        </div>
        
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">是否录单</label>
            <div class="layui-input-inline">
                <select name="is_record"  lay-filter="is_record" id="is_record" lay-search="">
                    <option value=0>全部</option>
                    <option value=1 >已录单</option>
                    <option value=2 >未录单</option>
                </select>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">是否录入资料</label>
            <div class="layui-input-inline">
                <select name="is_record_data"  lay-filter="is_record_data" id="is_record_data" lay-search="">
                    <option value=0>全部</option>
                    <option value=1 >已录入</option>
                    <option value=2 >未录入</option>
                </select>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">排序字段</label>
            <div class="layui-input-inline">
                <select name="sort_field"  lay-filter="sort_field" id="sort_field" lay-search="">
                    <option value=''>自增</option>
                    <option value='total_pay' >历史累充</option>
                    <option value='thirty_day_pay' >30天充值</option>
                    <option value='day_hign_pay' >单日最高充值</option>
                    <option value='last_pay_time' >最近充值时间</option>
                    <option value='last_login_time' >最近登录时间</option>
                    <option value='last_distribute_time' >最近分配</option>
                    <option value='last_record_time' >最近录单</option>
                </select>
            </div>
        </div>
        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">排序</label>
            <div class="layui-input-inline">
                <select name="sort"  lay-filter="sort" id="sort" lay-search="">
                    <option value='desc' >降序</option>
                    <option value='asc' >升序</option>
                </select>
            </div>
        </div>

        <div class="layui-inline" style="margin-bottom: 6px;">
            <label class="layui-form-label">是否建联</label>
            <div class="layui-input-inline">
                <select name="is_remark" lay-search="">
                    <option value=0>全部</option>
                    <option value=1>是</option>
                    <option value=2>否</option>
                </select>
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">角色等级</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="role_level_min" id="role_level_min" autocomplete="off" class="layui-input" value=>
            </div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="role_level_max" id="role_level_max" autocomplete="off" class="layui-input" value=>
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">角色转生等级</label>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="role_zs_level_min" id="role_zs_level_min" autocomplete="off" class="layui-input" value=>
            </div>
            <div class="layui-input-inline" style="width: 100px;">
                <input type="text" name="role_zs_level_max" id="role_zs_level_max" autocomplete="off" class="layui-input" value=>
            </div>
        </div>

    </form>
</div>

<div class="layui-btn-group demoTable"  style="padding: 0 30px; float: right;">
    <button class="layui-btn layui-btn-sm layui-power" id="Vip-userInputInfoList" data-type="search">搜索</button>
    <button type="button" class="layui-btn layui-btn-sm layui-power layui-btn-warm" id="Vip-vipUserInfoListExcel" data-type="excel">
        <i class="layui-icon"></i>导出Excel
    </button>
    <button type="button" class="layui-btn layui-btn-sm layui-power layui-btn-danger" id="Vip-vipDistribution" data-type="change">
        <i class="layui-icon"></i> 批量添加VIP
    </button>
    <button type="button" class="layui-btn layui-btn-sm layui-power layui-btn-danger" id="Vip-vipDistributionDelete" data-type="change_no">
        <i class="layui-icon"></i> 批量移除VIP
    </button>
</div>

<div class="table_wrap" style="padding: 0 15px;">
    <table id="idTest" lay-filter="demo" class="layui-table"></table>
</div>

<script>
    var lay_page = 1;
    var where = {};
    var check_ids = [];

    var layui_obj = layui.config({
        //version: true,
        base: '/assets/model/'
    }).extend({
        common: 'common/js/common',
        search: 'common/js/search',
    }).use(['common','jquery','search','table','laydate','form','xmSelect','excel'], function(){
        var table   = layui.table,
            laydate = layui.laydate,
            form = layui.form,
            xmSelect = layui.xmSelect;

        var $ = layui.jquery;
        var common = layui.common;
        var search = layui.search;

        //日期范围
        laydate.render({
            elem: '#last_distribute_time',
            range: true,
        });

        //日期范围
        laydate.render({
            elem: '#first_distribute_time',
            range: true,
        });

        //日期范围
        laydate.render({
            elem: '#last_login_time',
            range: true,
        });
        //日期范围
        laydate.render({
            elem: '#last_pay_time',
            range: true,
        });

        //日期范围
        laydate.render({
            elem: '#last_record_time',
            range: true,
        });
        
        initData();

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            if( type=='search' ){
                //搜索
                let form_data = $('#search_form').serializeArray();
                $.each(form_data,function(k,v){
                    where[v.name] = v.value;
                })
                table.reload('idTest', {
                    method: 'post'
                    ,where: where
                    ,page: {
                        curr: 1
                    }
                });
            }else if( type=='change' ){

                var checkStatus = table.checkStatus('idTest')
                    ,data = checkStatus.data;
                check_ids = [];
                if( data.length<=0 ){
                    layer.msg("未选择任何行！",{icon:2});
                    return;
                }

                for( var i=0; i<data.length; i++ ){
                    check_ids.push(data[i]['id']);
                }
                console.log(check_ids);
                
                layer.open({
                    type: 1,
                    title: "修改",
                    maxmin: true,
                    shadeClose: true, //点击遮罩关闭层
                    area : ['85%' , '95%'],
                    content: $('#distribution-form')
                });
            }else if( type=='change_no' ){
                var checkStatus = table.checkStatus('idTest')
                    ,data = checkStatus.data;

                if( data.length<=0 ){
                    layer.msg("未选择任何行！",{icon:2});
                    return;
                }
                var ids = [];
                for( var i=0; i<data.length; i++ ){
                    ids.push(data[i]['id']);
                }
                console.log(ids);
                layer.confirm('真的剔除分配选中行么', function(index){
                    layer.close(index);
                    common.req({
                        url: "vip/vipDistributionDelete",
                        data: { id: ids },
                        type: "post",
                        dataType:"json",
                        success:function(res){
                            if( res.code==0 ){
                                // obj.del();
                                layer.msg(res.msg,{icon:1});
                                // window.location.reload(); //刷新页面
                                layui_obj.table.reload('idTest', {
                                    method: 'post'
                                    ,where: where
                                    ,page: {
                                        curr: 1
                                    }
                                });
                            }else{
                                layer.msg(res.msg,{icon:2});
                            }
                        },
                        error:function(data){
                            layer.alert('错误'+data.msg,{icon:2});
                        }
                    });

                });
            }else if( type=='excel' ){
                loading = layer.load(1, {shade: [0.3, '#fff']});
                var excel = layui.excel;
                console.log(excel)
                //搜索
                let form_data = $('#search_form').serializeArray();
                // console.log(form_data);return;
                var this_where = {};
                $.each(form_data,function(k,v){
                    this_where[v.name] = v.value;
                })
                this_where['is_excel'] = 1;
                common.req({
                    url: 'vip/vipUserInfoListExcel',
                    dataType: 'json',
                    type: "post",
                    data: this_where,
                    success: function(res) {
                        layer.close(loading);
                        layer.msg(res.msg);
                        // 1. 数组头部新增表头
                        if (res.code == 0) {

                            var excel_field = {
                                user_name: '用户名',
                                uid: '用户名id',
                                vip_grade: 'VIP等级',
                                vip_date: '达成VIP时间',
                                product_name: '最近充值的产品',
                                game_name: '最近充值的子游戏',
                                mobile: '绑定手机号',
                                server_id: '最近充值区服id',
                                server_name: '最近充值区服',
                                role_id: '充值角色ID',
                                role_name: '角色名',
                                role_level: '角色等级',
                                role_zs_level: '角色转生等级',
                                recharge_static: '账号充值状态',
                                login_static: '账号登录状态',
                                last_thirty_day_hign_pay_game: '近30天累充最高产品游戏',
                                ascription_vip_name: 'VIP专员',
                                last_pay_time: '最近充值时间',
                                total_pay: '历史累充',
                                before_remark_pay:'建联前充值',
                                remark_pay:'建联后充值',
                                remark_month_pay:'当月维护业绩',
                                today_pay: '今日充值',
                                day_hign_pay: '单日最高金额',
                                last_thirty_day_pay_count: '近30天充值总额',
                                last_distribute_time: '最近分配时间',
                                last_record_time: '最近录单时间'
                            };
                            var excel_field_arr = [];
                            
                            $.each(excel_field,function(k,v){
                                excel_field_arr.push(k);
                            })

                            var data = excel.filterExportData(res.data, excel_field_arr);
                            
                            data.unshift(excel_field);
                            // 3. 执行导出函数，系统会弹出弹框
                            excel.exportExcel({
                                sheet1: data
                            }, res.name+'.xlsx', 'xlsx');
                        }
                    },
                    error:function(res){
                        layer.close(loading);
                        layer.msg(res.msg);
                    }
                });
            }
        });

        //监听工具条
        table.on('tool(demo)', function(obj) {
            var data = obj.data;
            if(obj.event === 'edit_vip_user_other_info'){
                //编辑
                layer.open({
                    type: 2,
                    title: "修改",
                    maxmin: true,
                    shadeClose: true, //点击遮罩关闭层
                    area : ['80%' , '60%'],
                    content: "vip_user_other_info_detail.html?platform_id="+data.platform_id+"&uid="+data.uid+"&user_name="+data.user_name+"&id="+data.id
                });
            } else if(obj.event === 'delete_vip_user_distribution'){
                layer.confirm('真的剔除分配此行么', function(index){
                    layer.close(index);
                    common.req({
                        url: "vip/vipDistributionDelete",
                        data: { id: [data.id] },
                        type: "post",
                        dataType:"json",
                        success:function(res){
                            if( res.code==0 ){
                                // obj.del();
                                layer.msg(res.msg,{icon:1});
                                // window.location.reload(); //刷新页面
                                table.reload('idTest', {
                                    method: 'post'
                                    ,where: where
                                    ,page: {
                                        curr: 1
                                    }
                                });
                            }else{
                                layer.msg(res.msg,{icon:2});
                            }
                        },
                        error:function(data){
                            layer.alert('错误'+data.msg,{icon:2});
                        }
                    });

                });
            } else if(obj.event === 'userinfo'){
                //用户详情
                var url = "sell_work_order_info.html?id="+data.id;

                var this_index = layer.open({
                    type: 2,
                    title: "详情",
                    maxmin: true,
                    shadeClose: true, //点击遮罩关闭层
                    area : ['80%' , '60%'],
                    content: url
                });

                layer.full(this_index);
            }

        });

        form.on('submit(submit_btn_distribution)', function(data){

            data.field.idStr = check_ids;

            common.req({
                url: 'vip/vipDistribution',
                data: data.field,
                type: "post",
                dataType:"json",
                success:function(res){
                    if( res.code==0 ){
                        res_msg(res.msg);
                        layer.closeAll();
                    }else{
                        layer.msg(res.msg,{icon:2});
                    }
                },
                error:function(res){
                    layer.alert('错误'+res.msg,{icon:2});
                }
            });
            return false;
        });

        function initData(){

            common.initPowerShow([
                'Vip-userInputInfoList'
                ,'Vip-vipUserInfoListExcel'
                ,'Vip-vipDistribution'
                ,'Vip-vipDistributionDelete'
            ]);

            common.req({
                url: 'vip/vipUserInfoListConfig' //获取游戏名称
                ,success:function(json)
                {

                    var kf_source_data = [];

                    var base_config = json.data;

                    $.each(base_config.admin_list,function(k,v){
                        $('select[name=admin_id]').append('<option value="'+v.id+'">'+v.name+'</option>');
                    });

                    search.init('common_search',base_config.search_config);

                    // 数据表格
                    table.render({
                        elem: '#idTest'
                        ,height: 'full-120'
                        ,url: common.getUrl('vip/vipUserInfoList') //数据接口
                        ,headers:common.getHeader()
                        ,page: true
                        ,limits:[20,50,100,200,500]
                        ,limit:20
                        ,minWidth:1000
                        ,autoWidth:true
                        ,method:'POST'
                        ,cols: [[ //表头
                            { type:'checkbox', minWidth:40, fixed: 'left' }
                            ,{field:'user_name', minWidth:110, fixed: 'left', sort: true, event:'userinfo',title:'用户名'}
                            ,{field:'uid', minWidth:120,title:'uid'}
                            ,{field:'vip_grade', minWidth:90,title:'VIP等级'}
                            ,{field:'vip_date', minWidth:160, sort: true,title:'达成VIP时间'}
                            ,{field:'product_name', minWidth:120,title:'最近充值产品'}
                            ,{field:'game_name', minWidth:130,title:'最近充值子游戏'}
                            ,{field:'mobile', minWidth:100, title:'绑定手机号1',templet:function(d){
                                let str = '';
                                if(d.action && d.action.length>0 && d.action.indexOf('decryptMobile')!= -1){
                                    str +='<div class="mobile_parent" onclick="decrypt_mobile('+d.platform_id+','+d.uid+',this)">'+d.mobile+'</div>';
                                }else{
                                    str += d.mobile;
                                }
                                return str;
                            }}
                            ,{field:'server_id', minWidth:125,title:'最近充值区服id'}
                            ,{field:'server_name', minWidth:130, sort: true,title:'最近充值区服'}
                            ,{field:'role_id', minWidth:150,title:'充值角色ID'}
                            ,{field:'role_name', minWidth:150,title:'角色名'}
                            ,{field:'role_zs_level', minWidth:100,title:'角色转生等级'}
                            ,{field:'role_level', minWidth:90,title:'角色等级'}
                            ,{field:'recharge_static', minWidth:120,title:'账号充值状态'}
                            ,{field:'login_static', minWidth:120,title:'账号登录状态'}
                            ,{field:'last_thirty_day_hign_pay_game', minWidth:180,title:'近30天累充最高产品游戏'}
                            ,{field:'ascription_vip_name', minWidth:100,title:'VIP专员'}
                            ,{field:'total_pay', minWidth:120, sort: true,title:'历史累充'}
                            ,{field:'before_remark_pay', minWidth:120, sort: true,title:'建联前充值'}
                            ,{field:'remark_pay', minWidth:120, sort: true,title:'建联后充值'}
                            ,{field:'remark_month_pay', minWidth:120, sort: true,title:'当月维护业绩'}
                            ,{field:'today_pay', minWidth:120, sort: true,title:'昨天充值'}
                            ,{field:'is_today_pay', minWidth:120, sort: true,title:'今日充值'}
                            ,{field:'day_hign_pay', minWidth:130, sort: true,title:'单日最高金额'}
                            ,{field:'last_thirty_day_pay_count', minWidth:145, sort: true,title:'近30天充值总额'}
                            ,{field:'last_pay_time', minWidth:160, sort: true,title:'最近充值时间'}
                            ,{field:'last_login_time', minWidth:160, sort: true,title:'最近登录时间'}
                            ,{field:'last_distribute_time', minWidth:160, sort: true,title:'最近分配时间'}
                            ,{field:'last_record_time', minWidth:160, sort: true,title:'最近录单时间'}
                            ,{minWidth:163, align:'center', fixed: 'right', title:'操作'
                            ,templet:function(d){
                                    let str = '';
                                    if(d.action && d.action.length>0){
                                        $.each(d.action,function(k,v){
                                            str+= action(v);
                                        })
                                    }
                                    return str;
                                }
                            }
                        ]]
                        ,done:function(a,b,c){
                            lay_page = b;
                            if(c > 0){

                            }
                        }
                    });
                    form.render();
                }
            });
        }

        window.decrypt_mobile=function(p,u,e){
            $('.mobile_child').remove()
            // loading = layer.load(1, {shade: [0.3, '#fff']});
            var obj = $(e);
            common.req({
                url: 'vip/decryptMobile',
                dataType: 'json',
                type: "post",
                data: {'platform_id':p,'uid':u},
                success: function(res) {
                    // layer.close(loading);
                    
                    if (res.code == 0) {
                        obj.append('<span class="mobile_child" onclick="event.stopPropagation();" oncontextmenu="return false;" onselectstart="return false">'+res.data.mobile+'</span>');
                    }else{
                        layer.msg(res.msg);
                    }
                },
                error:function(res){
                    // layer.close(loading);
                    layer.msg(res.msg);
                }
            });
        }
        
    });
    
    //给子级调用
    function res_msg(msg){
        layer.msg(msg,{icon:1});
        setTimeout(function(){
            // window.location.reload();
            console.log(lay_page);
            layui_obj.table.reload('idTest', {
                method: 'post'
                ,where: where
                ,page: {
                    curr: lay_page
                }
            });
        },1000);
    }
    function action(action,data){
        let str = '';
        switch (action) {
            case 'vipUserOtherInfoDetail':
                str = '<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="edit_vip_user_other_info">录入资料</a>';
                break;
            case 'vipDistributionDelete':
                str = '<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete_vip_user_distribution">剔除分配</a>';
                break;
            default:

                break;
        }
        return str;
    }
</script>
</body>
</html>