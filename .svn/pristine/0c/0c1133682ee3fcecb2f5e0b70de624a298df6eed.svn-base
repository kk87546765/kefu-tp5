<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/common.css"/>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
    <style>
        .layui-col-space15 {
            /* margin: -7.5px; */
            margin:-7.5px 0 !important;
        }
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<form class="layui-form" action="" style="padding: 20px;" id="form-info" lay-filter="form-info">
    <div class="layui-form-item">
        <label class="layui-form-label">游戏</label>
        <div class="layui-input-inline">
            <select name="game"  lay-filter="game" id="game" lay-search="">
                <option value="">选择或搜索</option>

            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label" >关键词</label>
        <div class="layui-input-inline">
            <input type="text" class="layui-input"  name="keyword" value="">

        </div>
    </div>

    <div class="layui-form-item">
            <label class="layui-form-label">触发限制</label>
            <div class="layui-input-inline">
               <input type="checkbox" name="status" id='status' lay-skin="switch"  lay-text="开启|关闭"  lay-filter="status_btn">
            </div>
        </div>
        <div class="layui-form-item">
                <label class="layui-form-label">等级</label>
                <div class="layui-input-inline" style="width: 100px;">
                      <input type="text" name="level_min" placeholder="最低"    autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid">-</div>
                    <div class="layui-input-inline" style="width: 100px;">
                      <input type="text" name="level_max" placeholder="最高"   autocomplete="off" class="layui-input">
                    </div>
            </div>
        <div class="layui-form-item">
            <label class="layui-form-label">充值</label>
            <div class="layui-input-inline" style="width: 100px;">
                  <input type="text" name="money_min" placeholder="￥"   autocomplete="off" class="layui-input">
                </div>
                <div class="layui-form-mid">-</div>
                <div class="layui-input-inline" style="width: 100px;">
                  <input type="text" name="money_max" placeholder="￥"   autocomplete="off" class="layui-input">
                </div>
        </div>

    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="submit_btn">立即提交</button>
        </div>
    </div>
    <input type="hidden" id='id' name="id" value="{{ info['id'] }}">
</form>

<script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
<script>
    var where = {};
    layui.config({
        version: true,
        base: '/assets/model/'
    }).extend({
        common: 'common/js/common',
        search: 'common/js/search',
    }).use(['form','jquery','common'], function(){
        var form = layui.form,
            common = layui.common,
            $ = layui.jquery;

        var pdata = common.urlParam;

        form.on('switch(status_btn)', function(data){
            if(data.elem.checked){
                $('input[name="level_min"]').removeAttr("disabled");
                $('input[name="level_max"]').removeAttr("disabled");
                $('input[name="money_min"]').removeAttr("disabled");
                $('input[name="money_max"]').removeAttr("disabled");

            }else{
                $('input[name="level_min"]').attr("disabled","disabled");
                $('input[name="level_max"]').attr("disabled","disabled");
                $('input[name="money_min"]').attr("disabled","disabled");
                $('input[name="money_max"]').attr("disabled","disabled");

            }
        });

        common.req({
            url: "sensitive/getOne?id="+pdata.id,
            type: "post",
            dataType:"json",
            success:function(data){
                console.log(data.data)
                form.val('form-info', data.data);
            },
            error:function(res){
                layer.alert('错误'+res.msg,{icon:2});
            }

        })

        common.req({
            url: "sensitive/getGameList",
            type: "post",
            dataType:"json",
            success:function(data){

                var optionstring = "";
                optionstring += "<option value='' >请选择游戏</option>";
                $.each(data.data, function(i,item){

                    optionstring += "<option value=\"" + i + "\" >" + item.name + "</option>";
                });

                $("#game").html(optionstring);
                form.render('select'); //这个很重要
            },
            error:function(res){
                layer.alert('错误'+res.msg,{icon:2});
            }

        })



        //监听提交
        form.on('submit(submit_btn)', function(data){
            if(data.field.status == 'on'){
                data.field.status = 1;
            }
            if(data.field.resemble_status == 'on'){
                data.field.resemble_status = 1;
            }
            data.field.id = pdata.id;
            common.req({
                url: "sensitive/edit",
                data: data.field,
                type: "post",
                dataType:"json",
                success:function(data){
                    if( data.code == 0 ){
                        var index = parent.layer.getFrameIndex(window.name);
                        layer.open({
                            title: '提示'
                            ,content: data.msg
                            ,btn: ['确定']
                            ,yes: function(index, layero){
                                parent.layer.close(index);
                                window.parent.location.reload()
                        }
                        });
                        // window.parent.res_msg(data.msg);
                        // parent.layer.close(index);//关闭当前页
                        //window.parent.location.reload(); //刷新父窗口
                    }else{
                        layer.msg(data.msg,{icon:2});
                    }
                },
                error:function(data){
                    layer.alert('错误'+data.msg,{icon:2});
                }
            });
            return false;
        });
    });
</script>
</body>
</html>