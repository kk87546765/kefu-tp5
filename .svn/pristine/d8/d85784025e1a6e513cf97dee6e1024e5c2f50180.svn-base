{% include 'common/header_layui.volt' %}
<body class="hold-transition skin-blue sidebar-mini">
<form class="layui-form" action="" style="padding: 20px;">
    <input type="hidden" name="idStr" value="{{ idStr }}">
    <div class="layui-form-item p_menu p_lev1">
        <label class="layui-form-label">vip专员</label>
        <div class="layui-input-inline">
            <select name="ascription_vip"  lay-filter="ascription_vip" id="ascription_vip" lay-search="">
                {% for k,v in ascription_vip_list %}
                <option value="{{ k }}">{{ v['realname'] }}({{ v['username'] }})</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="submit_btn">立即提交</button>
        </div>
    </div>
</form>

<script>
    layui.use(['form'], function(){
        var form = layui.form;
        //监听提交
        form.on('submit(submit_btn)', function(data){
            console.log(data.field);
            $.ajax({
                url: "/admin/{{controller}}/batch_distribution_vip",
                data: data.field,
                type: "post",
                dataType:"json",
                success:function(data){
                    console.log(data);
                    if( data.status==1 ){
                        var index = parent.layer.getFrameIndex(window.name);
                        window.parent.res_msg(data.msg);
                        parent.layer.close(index);//关闭当前页
                        //window.parent.location.reload(); //刷新父窗口
                    }
                },
                error:function(data){
                    layer.alert('错误'+data.msg,{icon:2});
                }
            });
            return false;
        });
        form.on('checkbox()')
    });
</script>
</body>
</html>