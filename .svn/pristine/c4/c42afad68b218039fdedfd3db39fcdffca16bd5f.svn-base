<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>登陆系统</title>
    <link rel="stylesheet" href="/assets/vendor/layui/css/layui.css"/>
    <link rel="stylesheet" href="/assets/model/common/css/style.css"/>
    <link rel="stylesheet" href="/assets/plug/particles/particles.css"/>
    <script type="text/javascript" src="/assets/plug/particles/particles.js"></script>
    <!--[if lt IE 9]>
    <script src="/assets/model/common/js/html5shiv.min.js"></script>
    <script src="/assets/model/common/js/respond.min.js"></script>
    <![endif]-->
</head>
<style>
body{background-color:#30333F;overflow: hidden;height: 100%;}
.layui-fluid{z-index: 1;padding-top: 150px;}
.layui-card{max-width: 360px;margin: 0 auto;}
.layui-card-header span{font-weight: 700;font-size: 15px;margin-left: 3px;}
.layui-form-pane .layui-form-label{width: 48px;}
.layui-form-pane .layui-input-block{margin-left: 48px;}
.verifyimg{width: 100%;height: 65px;cursor: pointer;}
</style>
<body>
    <div id="particles-js">
        <div class="layui-fluid">
            <div class="layui-card" id="login_model">
                <div class="layui-card-header">
                    <i class="layui-icon layui-icon-engine"></i>
                    <span>用户登陆</span>
                </div>
                <form class="layui-card-body layui-form layui-form-pane">
                    <div class="layui-form-item">
                        <label class="layui-form-label"><i class="layui-icon layui-icon-username"></i></label>
                        <div class="layui-input-block">
                            <input name="username" type="text" placeholder="账号" autocomplete="off" class="layui-input" lay-vertype="tips" lay-verify="required|verify_username" required="">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label"><i class="layui-icon layui-icon-password"></i></label>
                        <div class="layui-input-block">
                            <input name="password" type="password" placeholder="密码" autocomplete="off" class="layui-input" lay-vertype="tips" lay-verify="required|verify_password" required="">
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <button lay-filter="login-submit" class="layui-btn layui-btn-fluid layui-btn-lg" lay-submit="">登 录</button>
                    </div>
                </form>
            </div>
            <div id="platform_model" class="layui-card" style="display: none;">
                <form class="layui-card-body layui-form layui-form-pane">
                    <div class="layui-form-item">
                        <div class="layui-input-block" id="platform_div">
                            <!-- <input type="radio" name="platform" value="ll" title="流连"> -->
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <button lay-filter="platform-submit" class="layui-btn" lay-submit="">确认</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
	<!-- 加载动画 -->
	<div class="page-loading">
	    <div class="ball-loader">
	        <span></span><span></span><span></span><span></span>
	    </div>
	</div>
    <script type="text/javascript" src="/assets/vendor/layui/layui.js"></script>
    <script type="text/javascript" src="/assets/plug/crypto/crypto-js.js"></script>
    <script>
    layui.config({
        version: true,
        base: '/assets/model/'
    }).extend({
        common: 'common/js/common',
    }).use(['layer', 'form','jquery','common'], function () {
        var $ = layui.jquery;
        var common = layui.common;
        var layer = layui.layer;
        var msg = '';

		common.isLoading(false);
        var form = layui.form;

        particlesJS.load('particles-js', '/assets/plug/particles/particles.json', function() {});
  
        form.verify({
            verify_username:function(value, item)
            {
                if(!/^[A-Za-z0-9]+$/.test(value))
                {
                    return '只允许字母和数字。';
                }
                if(value.length > 20)
                {
                    return '用户名不能大于64个字符。';
                }
            }
            ,verify_password:function(value, item)
            {
                if(value.length > 100)
                {
                    return '密码不能大于100个字符。';
                }
            }
            ,verify_code:function(value, item)
            {
                if(!/^[A-Za-z0-9]+$/.test(value))
                {
                    return '只允许字母和数字。';
                }
                if(value.length != 5)
                {
                    return '验证码必须为5个字符。';
                }
            }
        });
        form.on('submit(login-submit)', function (obj) {
            layer.load(2);
            layui.data('roleData', null);//点击提交按钮的时候则清除以前的缓存
            layui.data('userData', null);//点击提交按钮的时候则清除以前的缓存

            // obj.field.password = CryptoJS.MD5(obj.field.password).toString();
			common.req({
				url:'Login/index'
				,data:obj.field
				,success:function(json)
				{
                    if(json.code == 0)
                    {
						common.putTempData('token',json.data.token);
                        common.putTempData('user',json.data.user);
                        var platform_list = json.data.platform_list;
                        msg = json.msg;
                        if(platform_list.length == 1){
                            common.putTempData('platform',platform_list[0].suffix);
                            goIndex();
                        }else if(platform_list.length > 1){
                            layer.closeAll('loading');
                            $.each(platform_list,function(k,v){
                                $('#platform_div').append('<input type="radio" name="platform" value="'+v.suffix+'" title="'+v.name+'">');
                            })
                            form.render();
                            $('#login_model').hide();
                            $('#platform_model').show();
                        }else{
                            layer.msg('没有平台权限',{icon:2,time:1500},function(){
                                layer.closeAll('loading');
                                // get_code();
                            });
                        }
                    }
                    else
                    {
                        layer.msg(json.msg,{icon:2,time:1500},function(){
                            layer.closeAll('loading');
                            // get_code();
                        });
                    }
				}
			});
            return false;
        });

        form.on('submit(platform-submit)', function (obj) {
            var platform = obj.field.platform;

            if(!platform){
                layer.msg('请选择平台',{icon:1,time:1500});
                return false;
            }
            common.putTempData('platform',platform);
            goIndex();
            return false;
        });



        function goIndex(){
            layer.msg(msg,{icon:1,time:1500},function()
            {
                window.location.href = 'index.html';
            });
        }
    });
    </script>
</body>
</html>