<?php

use common\GamekeySignBase\GamekeySignBase;

class csios extends GamekeySignBase
{

    public $from = 'zhangWan';
    public $secret = 'skHVv95EI7DG1sAzdNZZxlFDyG3IKCre';
    public $uid_to_sdkid_url =  "http://data-service.tanwan.com/customerService/user-info/search-uid";

    public $sdkid_to_uid_url = "http://data-service.tanwan.com/customerService/user-info/search-openid";

	public function __construct(){

    }

    #根据平台自身的uid换cp给的聚合uid，用于调用cp封禁、禁言接口
    public function uid_to_sdkid_url($sdkid){

	    if(empty($sdkid)){
	        return false;
        }


	    $time = time();
	    $sign = md5($this->secret.$time);
	    $data['openid_list'] = json_encode([$sdkid]);
	    $data['from'] = $this->from;
	    $data['ts'] = $time;
	    $data['sign'] = $sign;
        $url = $this->uid_to_sdkid_url.'?'.urldecode(http_build_query($data));

        $res = $this->fetchUrl($url);

        $res = json_decode($res,1);

        if($res['code'] == 200){
            return $res['data'][$sdkid];
        }else{
            return false;
        }

    }



}